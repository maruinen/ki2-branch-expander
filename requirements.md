# 要件定義 (Requirements)

## 目的
同一局面の自動合流をサポートしない KI2 ビューア（例: 旧来の GUI アプリケーション）において、すべての可能な手順と分岐を漏れなく表示できるように、棋譜をツリー状に全展開する。

## ターゲット
- 同一局面を自動合流（グラフ表示）できない KI2 ビューアを利用しているユーザー。
- 複雑な分岐を含む棋譜を、単一の木構造として出力したい開発者。

## 機能要件 (Key Features)

1. **局面同一性判定**:
   - `python-shogi` を用いて、盤面（駒配置、手番、持駒）をシミュレートし、正確に同一局面を識別する。
2. **分岐の全展開**:
   - ある局面で過去に指されたすべての手を、その局面へのあらゆる到達経路に対して複製する。
3. **KI2 相対表記の完全サポート**:
   - `右`, `左`, `直`, `寄`, `上`, `引`, `打` などの相対表記を正しく解釈し、出力時にも維持・再生成する。
4. **成り・不成のサポート**:
   - `成`, `不成` の指定を正確に扱う。
5. **ヘッダー情報の維持**:
   - 対局者名や対局名などの棋譜ヘッダー情報を変更せずに出力ファイルへ引き継ぐ。
6. **千日手検知**:
   - 無限ループを防止するため、同一経路内での循環を検知して停止する。

## 制約事項
- **エンコーディング**: 入出力ともに `cp932` (Shift_JIS) を原則とする。
- **入力形式**: 分岐を含む標準的な KI2 形式。

技術的な設計については [design.md](design.md) を参照してください。
