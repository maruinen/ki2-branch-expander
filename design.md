# 設計詳細

## データ構造
- **局面ハッシュマップ**: `dict[str, set[shogi.Move]]`
  - キー: 局面のSFEN文字列（盤面状態をユニークに表す文字列）
  - 値: その局面から指されたことがある「次の手」の集合。
- **パス探索**:
  - 再帰的に棋譜を走査し、一度通った局面でも、未登録の「次の手」があればマップを更新する。

## 処理アルゴリズム
1. **第一パス（収集）**: 
   元のKI2をパースし、出現するすべての局面と、そこから指された手をハッシュマップに記録する。
2. **第二パス（再構築）**:
   ルート局面から再度探索を開始する。各局面で、ハッシュマップに登録されている「すべての指し手」を分岐として書き出す。
   - ※無限ループ防止のため、同一経路内での循環参照（千日手など）は適切に処理する。

## ファイル構成
- `main.py`: CLIエントリポイント
- `logic/expander.py`: 局面マージおよびツリー展開ロジック
- `logic/parser.py`: KI2のパース・出力補助

## 実行方法 (How to Execute)
1. **依存関係のインストール**:
   ```bash
   pip install python-shogi
   ```
2. **エキスパンダーの実行**:
   ```bash
   python3 main.py [入力ファイル ...]
   ```
   `[入力ファイル ...]` は、処理するKI2ファイルを1つ以上指定します。入力ファイルが指定されない場合、現在のディレクトリに存在する `ShogiSekai.ki2` および `Test1.ki2` がデフォルトで処理されます。
   ツールは、各入力ファイルに対して `[入力ファイル]_expanded.ki2` を出力します。

   **例**:
   ```bash
   python3 main.py my_game.ki2 another_game.ki2
   ```
   これにより、`my_game.ki2` と `another_game.ki2` が処理され、`my_game_expanded.ki2` および `another_game_expanded.ki2` が生成されます。