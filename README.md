# Ki2 Branch Expander

**Ki2 Branch Expander** は、将棋の棋譜形式である KI2 ファイルにおいて、合流した局面（同一局面）から先の分岐をすべての経路に複製・展開するためのツールです。

## 概要

多くの KI2 ビューアは、異なる手順で同一局面になった場合の自動合流（グラフ表示）をサポートしておらず、厳密なツリー構造を期待します。このツールは、合流した局面から先の指し手をすべての経路にコピーすることで、どの手順からでもすべての分岐を閲覧できるようにします。

## ディレクトリ構成

```text
.
├── main.py              # CLI エントリポイント
├── extract_moves.py     # KI2 パース・指し手抽出ロジック
├── logic/
│   ├── expander.py      # ツリー展開・表記生成の核心ロジック
│   └── utils.py         # 共通ユーティリティ
├── tests/               # ユニットテスト
├── design.md            # 技術設計・アルゴリズム詳細
├── requirements.md      # 機能要件・制約事項
├── GEMINI.md            # AI エージェント向けコンテキスト
└── README.md            # 本ファイル（プロジェクト概要・使い方）
```

## インストール

- **動作環境**: Python 3.10 以上
- **依存ライブラリ**: `python-shogi`

```bash
pip install python-shogi
```

## 使い方

1つ以上の KI2 ファイルを指定して実行します。

```bash
python3 main.py [入力ファイル ...]
```

- 各入力ファイルに対し、`[ファイル名]_expanded.ki2` が出力されます。
- ファイルを指定しない場合、カレントディレクトリの `ShogiSekai.ki2` と `Test1.ki2` をデフォルトで処理します。

## 開発とテスト

テストの実行:
```bash
python3 -m unittest discover tests
```

エンコーディング:
- 将棋ソフトの標準に合わせ、KI2 ファイルを `cp932` (Shift_JIS) で処理します。
